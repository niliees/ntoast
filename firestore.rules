rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // Admin UID documents: each admin has a doc whose ID == their auth.uid
    match /admin-uids/{uid} {
      allow read: if request.auth != null && request.auth.uid == uid; // owner can read own admin doc
      allow write: if false; // manage manually from console (adjust if you add an admin tool)
    }

    // Project submissions
    match /project-submissions/{docId} {
      // Anyone signed in can create a submission
      allow create: if request.auth != null;

      // Only admins can read submissions
      allow read: if request.auth != null && exists(/databases/$(database)/documents/admin-uids/$(request.auth.uid));

      // Updates & deletes disabled unless admin (adjust logic if needed)
      allow update, delete: if request.auth != null && exists(/databases/$(database)/documents/admin-uids/$(request.auth.uid));
    }

    // Deny everything else by default
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
{
  "hosting": [
    {
      "site": "nsce-fr1",
      "source": ".",
      "ignore": ["firebase.json", "**/.*", "**/node_modules/**", "**/.next/cache/**"]
    }
  ],
  "firestore": {
    "rules": "firestore.rules"
  }
}

